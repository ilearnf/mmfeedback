@model Mmfeedback.Models.ViewModels.ReviewCreatorModel

@using System.Web.Mvc;

@{
	ViewBag.Title = "Добавить отзыв @@ Mmfeedback";
}

<html>
    <head>
        <meta charset="UTF-8">
		<style>
		body{
		  background: linear-gradient(90deg, #403b4a 10%, #e7e9bb 90%);
		}
		#container{
		  text-align: center;
		  width: 700px;
		  margin: 0 auto;
		}
		button{
		  margin: 0 auto;
		  display: inline-block;
		  background: #4899ad;
		  padding: 8px 15px 8px 15px;
		  border: 1px solid black;
		  color: #fff;
		}
		button:hover{
		  background: #4691a4;
		  box-shadow:none;
		}
		input{
		  height: 25px;
		  margin: 0 auto;
		  padding-bottom: 10px;
		  padding-top: 15px;
		}
		div#scroll{
		  display: inline-block;
		  text-align: center;
		  width: inherit;
		  margin: 0 auto;
		}
		table#tagsToAdd{
		  width: 50%;
		  margin: 0 auto;
		}
		input.input{
		  width: 80%;
		}
		div.checkbox label input{
		  margin-right: 100px
		}
		div.checkbox{
		  margin: 4px;
		  background-color: #EFEFEF;
		  border-radius: 4px;
		  border: 1px solid #D0D0D0;
		  float: left;
		}
		div.checkbox label{
		  float: left;
		  width: 10em;
		}
		div.checkbox label span{
		  text-align: center;
		  padding: 3px 0px;
		  display: block;
		}
		div.checkbox label input{
		  position: absolute;
		  top: -20px;
		}
		div.checkbox input:checked + span{
		  background-color: #ff6600;
		  color: #fff;
		}
		div.checkbox:hover{
		  background-color:orange;
		}
		span.alert{
		    color: red;
		}
		input.error{
		    border: 2px solid red;
		}
		#select{
		    border: 1px solid #dbdbdb;
		    overflow: hidden;
		    width: 300px;
		    height: 35px;
		    padding: 5px;
		    line-height: 1;
		    background: #454545;
		    color: white;
		}
		.label{
		    font-weight: bold;
		    color: #dbdbdb;
		}
		#search{
		    width: 100%;
		}
		</style>
		<link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">
		<script src="@Url.Content("~/Scripts/jquery-1.11.3.min.js")"></script>
		<script type='text/javascript'>
		function stringStartsWith(base, prefix){
		    return base.slice(0, prefix.length) == prefix;
		}
		var userName = "";
		var userUrl = "";
		var markedTags = [];
		$(document).ready(function(){
		    $("#search").on("input", function(){
		        $(".tagCheckbox").each(function(){
		            if (stringStartsWith($(this).val(), $("#search").val()))
		                $(this).parent().parent().show();
		            else
		                $(this).parent().parent().hide();
		        });
	            if ($(".checkbox:visible").length == 0)
	                $("#addTag").css("visibility", "visible");
	            else
	                $("#addTag").css("visibility", "hidden");
		    });
		    $("#addTag").on("click", function(){
		        var newTag = $("#search").val();
		        var newCheckbox = '<tr><td><div class="checkbox"><label><input class="tagCheckbox" type="checkbox"' + 
			        'value="' + newTag + '" /><span>' + newTag + '</span></label></div></td></tr>';
		        $("#tagsToAdd").append(newCheckbox);
		    });
		    $("#sign").on("click", function(){
		        window.open("/Act/VkLogin", "login", "width=800, heght=600, location=0", true);
		        return false;
		    });
		    $("#form").on("submit", function(){
		        $(".tagCheckbox:checked").each(function(){
		            markedTags.push($(this).val());
		        });
		        var valid = true;
		        $("#tagsTextBox").val(markedTags.join(','));
		        $(".required").each(function(){
		            if ($(this).val() == ""){
		                $(this).after("<span class='alert'>Required!</span>");
		                $(this).addClass("error");
		                valid = false;
		            }
			        setTimeout(function(){
		                $(".alert").each(function(){
		                    $(this).fadeOut("fast");
		                    $(".error").each(function(){
		                        $(this).removeClass("error");
		                    });
		                });
		            }, 4000);
		        });
		        return valid;
		    });         
		});
		</script>
	</head>
	<body>
	    <header class="w3-container w3-blue-grey">
	        <h1>Add</h1>
	    </header>
	    <div id="container">
	        <a href="@Url.Action("Index", "Home")">На главную</a>
		    @using (Html.BeginForm("AddReview", "Act", null, FormMethod.Post, new { @id = "form" })){
		        @Html.TextBoxFor(m => m.Form.Title, new { @class="input required", @placeholder="Название отзыва" })
		        @Html.TextAreaFor(m => m.Form.Description, 20, 55, new { @class="input required", @placeholder="Текст отзыва" })
		        @Html.TextBoxFor(m => m.Form.Tags, new { @id = "tagsTextBox", @style="display: none" });
		        <br>
		        <button type="button" id="addTag" style="visibility: hidden">Добавить тег</button>
		        <input type="text" id="search" placeholder="search" class="input" />
		        <br>
			    <div id="scroll" style="overflow:auto; height: 300px">
			        <table id="tagsToAdd">
			            @foreach(var tag in Model.Tags){
			                <tr><td>
			                    <div class="checkbox">
			                        <label>
						                <input class="tagCheckbox" type="checkbox" value="@tag" /><span>@tag</span>
						            </label>
						        </div>
						    </td></tr>
						}
					</table>
				</div>
				<br>
				@Html.Label("Выберите категорию", new { @class = "label" });
				<br>
				@Html.DropDownListFor(m => m.Form.Category, Model.Categories, new { @id = "select", @class = "input required" } );
				@Html.TextBoxFor(m => m.Form.Author, new { @id = "author", @style="display: none" });
				<br>
				<button type="button" id="sign">Подписать отзыв</button>
				<br>
				<button id="submit" type="submit">Готово!</button>
			}
		</div>
	</body>
</html>
